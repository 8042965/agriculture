<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>添加管理员信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="css/public.css" media="all">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<div class="layui-form layuimini-form" lay-filter="editForm">

    <div class="layui-form-item">
        <label class="layui-form-label required">用户名</label>
        <div class="layui-input-block">
            <input type="text" name="managerName" lay-verify="required" lay-reqtext="用户名不能为空"
                   placeholder="请输入用户名" value="" class="layui-input">
            <tip style="color: red">用户名是登录的用户名，必须要输入才可登录</tip>
        </div>
    </div>

    <div class="layui-form-item class_password">
        <label class="layui-form-label required">登录密码</label>
        <div class="layui-input-block">
            <input type="text" name="password" lay-verify="required" lay-reqtext="登录密码不能为空"
                   placeholder="请输入登录密码" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item class_password">
        <label class="layui-form-label required">确定登录密码</label>
        <div class="layui-input-block">
            <input type="text" name="again_password" lay-verify="required" lay-reqtext="确定登录密码不能为空"
                   placeholder="请再次输入登录密码" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item ">
        <label class="layui-form-label required">管理员姓名</label>
        <div class="layui-input-block">
            <input type="text" name="userName" lay-verify="required" lay-reqtext="管理员姓名不能为空"
                   placeholder="请输入管理员姓名" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label ">性别</label>
        <div class="layui-input-block">
            <input type="radio" name="sex" value="1" title="男" checked="">
            <input type="radio" name="sex" value="2" title="女">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">年龄</label>
        <div class="layui-input-block">
            <input type="text" name="age"
                   placeholder="请输入年龄" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label ">手机</label>
        <div class="layui-input-block">
            <input type="tel" name="phone" lay-verify="required"
                   placeholder="请输入手机" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label required">邮箱</label>
        <div class="layui-input-block">
            <input type="email" name="email"
                   placeholder="请输入邮箱" value="" class="layui-input" lay-reqtext="邮箱不能为空">
            <tip style="color: red">邮箱做为找回密码的唯一凭证，请认真填写！</tip>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label required">是否启用</label>
        <div class="layui-input-block">
            <input type="radio" name="start" value="1" title="未启用" checked="">
            <input type="radio" name="start" value="2" title="启用" >
            <br>
            <tip style="color: red">启用状态决定此用户是否可登录系统！</tip>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label required">权限</label>
        <div class="layui-input-block">
            <input type="radio" name="power" value="1" title="普通管理员" checked="">
            <input type="radio" name="power" value="2" title="超级管理员" >
            <br>
            <tip style="color: red">此权限决定登录后的用户的权限功能</tip>
        </div>
    </div>

    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">备注信息</label>
        <div class="layui-input-block">
            <textarea name="remarks" class="layui-textarea" placeholder="请输入备注信息"></textarea>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
        </div>
    </div>
</div>
<script src="lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="js/public.js" charset="utf-8"></script>

<script>



    layui.use(['form'], function () {
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;


        var pagrMark = getWindowURLKey("mark"); //获取URL传递过来的键值对 //此页面的标记 如果是edit则是编辑信息，如果是add则是添加信息
        var pageManagerId;//如果是编辑，则传递来了managerId，则通过此id回显数据

        //如果是编辑，就先回显数据
        if(pagrMark=="edit"){

            //隐藏密码输入框 class_password
            $(".class_password").remove();

            pageManagerId =  getWindowURLKey("managerId");//获取URL传递过来的键值对

            $.ajax({
                type: "GET",
                url: ServerIP+"/rest/agriculture/managerUserController/getManagerUserInfo",
                cache: false, //禁用缓存
                data: "managerId="+Number(pageManagerId),
                dataType: "json",
                success: function(result){

                    if (result.data!=null){
                        form.val('editForm',{
                            'userName':result.data.userName,
                            'sex':result.data.sex,
                            'age':result.data.age,
                            'phone':result.data.phone,
                            'email':result.data.email,
                            'remarks':result.data.remarks,
                            'managerName':result.data.managerName,
                            'start':result.data.start,
                            'power':result.data.power
                        })
                    }else{
                        //提示完然后跳转到主页
                        layer.msg('查询失败', function () {
                        });
                    }
                },
                error: function(e){
                    console.log(e)
                }
            });


        }

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            data = data.field;
            data.managerId = pageManagerId;

            //如果是编辑
            if(pagrMark=="edit"){

                $.ajax({
                    type: "POST",
                    url: ServerIP+"/rest/agriculture/managerUserController/editManagerUserInfo",
                    cache: false, //禁用缓存
                    data: data,
                    dataType: "json",
                    success: function(result){

                        if (result.data!=null){

                            layer.msg('修改成功', function () {
                                //回显数据

                                // getManagerUserInfo(form);

                            });

                        }else{
                            layer.msg('修改失败', function () {

                            });
                        }
                    },
                    error: function(e){
                        console.log(e)
                    }
                });

            }else if(pagrMark=="add"){

                if (data.managerName == '' || data.userName == '' || data.email == '' || data.password != data.again_password) {
                    layer.msg('要求必须输入的信息有问题不能为空，请检查后再试！');
                    return false;
                }else{

                    $.ajax({
                        type: "POST",
                        url: ServerIP+"/rest/agriculture/managerUserController/addManagerUserInfo",
                        cache: false, //禁用缓存
                        data: data,
                        dataType: "json",
                        success: function(result){

                            if (result.status==1){

                                layer.msg('添加成功', function () {
                                    window.location = 'managerAdmin.html';
                                });

                            }else{
                                layer.msg('添加失败', function () {

                                });

                            }
                        },
                        error: function(e){
                            console.log(e)
                            layer.msg('添加失败', function () {

                            });

                        }
                    });
                }

            }



            return false;
        });

    });
</script>
</body>
</html>